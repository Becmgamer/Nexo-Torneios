<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brawl Stars Cup NS - Nexo Studios</title>
<style>
  body { background: #0a0a1f; color: #00ffcc; font-family: Arial, sans-serif; padding: 20px; }
  h1, h2, h3 { color: #00ffcc; }
  input { display: inline-block; margin: 10px 0; padding: 8px; width: calc(70% - 10px); border-radius: 5px; border: 1px solid #00ffcc; background: #111; color: #00ffcc; }
  button { background: #00ffcc; border: none; padding: 10px; margin: 5px 0; cursor: pointer; border-radius: 5px; color: #000; font-weight: bold; }
  .torneio { border: 2px solid #00ffcc; padding: 15px; margin: 10px 0; border-radius: 10px; }
  img { max-width: 100%; border-radius: 10px; }
  #mensagemSucesso { color: #0f0; margin-top: 10px; display: none; }
</style>
</head>
<body>

<h1>Brawl Stars Cup NS</h1>

<div id="torneiosContainer"></div>
<div id="mensagemSucesso">Número enviado com sucesso! Obrigado.</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, updateDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDj5-aBr2n_wg80HswcaIOjetm7DtxILSI",
  authDomain: "nexostudios-site-e9458.firebaseapp.com",
  databaseURL: "https://nexostudios-site-e9458-default-rtdb.firebaseio.com",
  projectId: "nexostudios-site-e9458",
  storageBucket: "nexostudios-site-e9458.firebasestorage.app",
  messagingSenderId: "247851109985",
  appId: "1:247851109985:web:1b8903891240c55a376420"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let usuarioLogado = null;

// Detecta login
onAuthStateChanged(auth, (user) => {
  if(user){
    usuarioLogado = user;
    carregarTorneio();
  } else {
    document.getElementById('torneiosContainer').innerHTML = "<p>Faça login para acessar o torneio.</p>";
  }
});

// Carregar torneio
function carregarTorneio(){
  const container = document.getElementById('torneiosContainer');
  container.innerHTML = `
    <div class="torneio">
      <h2>Brawl Stars Cup NS</h2>
      <img src="https://i.postimg.cc/vBDwTGw1/cropped.webp" alt="Brawl Stars">
      <p>Data: 1º de março às 16h e 2 de março às 16h</p>
      <p>Taxa de inscrição: R$ 0,50</p>
      <p>Prêmios: 1º: R$ 10, 2º: R$ 3, 3º: R$ 1</p>
      <div style="display:flex; gap:5px; align-items:center;">
        <input type="text" id="telefone0" placeholder="Digite seu número para contato">
        <button id="enviarBtn">Enviar</button>
      </div>
      <button id="pixBtn">Pagar via Pix</button>
      <button id="presencialBtn">Pago pessoalmente</button>
    </div>
  `;

  // Adiciona eventos
  document.getElementById("enviarBtn").addEventListener("click", enviarNumero);
  document.getElementById("pixBtn").addEventListener("click", inscreverPix);
  document.getElementById("presencialBtn").addEventListener("click", inscreverPresencial);
}

// Enviar número
async function enviarNumero(){
  const telefone = document.getElementById("telefone0").value;
  if(!usuarioLogado){
    alert("Faça login primeiro!");
    return;
  }
  if(!telefone){
    alert("Digite seu número!");
    return;
  }

  const suporteRef = doc(db, "suporte", usuarioLogado.uid);
  await setDoc(suporteRef, { telefone }, { merge: true });

  // Mostrar mensagem por 2 segundos
  const msg = document.getElementById("mensagemSucesso");
  msg.style.display = "block";
  setTimeout(() => { msg.style.display = "none"; }, 2000);
}

// Inscrição via Pix
async function inscreverPix(){
  await inscrever("Pix");
}

// Inscrição presencial
async function inscreverPresencial(){
  await inscrever("Presencial");
}

// Função genérica de inscrição
async function inscrever(metodo){
  const telefone = document.getElementById("telefone0").value;
  if(!usuarioLogado){
    alert("Faça login primeiro!");
    return;
  }
  if(!telefone){
    alert("Digite seu número!");
    return;
  }

  const torneioRef = doc(db, "torneios", "BrawlStarsCupNS");
  const torneioSnap = await getDoc(torneioRef);
  const inscritos = torneioSnap.exists() && torneioSnap.data().inscritos ? torneioSnap.data().inscritos : [];

  await updateDoc(torneioRef, {
    inscritos: [...inscritos, {
      nome: usuarioLogado.displayName || "Nome",
      email: usuarioLogado.email,
      telefone,
      aprovado: false,
      metodo
    }]
  });

  alert(`Inscrição ${metodo} enviada! Aguarde confirmação.`);
}
</script>

</body>
</html>
