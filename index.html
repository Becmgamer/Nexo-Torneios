<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXO Studio - Torneios</title>

<style>
body{
    background:#0a0f1c;
    font-family:Arial, sans-serif;
    color:white;
    text-align:center;
}

.container{
    max-width:500px;
    margin:auto;
    padding:20px;
}

.card{
    background:#111a2e;
    border:2px solid #00ffcc;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
    box-shadow:0 0 20px #00ffcc;
}

button{
    background:#00ffcc;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    margin-top:10px;
}

button:hover{
    background:#00ffaa;
}

input{
    width:90%;
    padding:10px;
    margin:5px;
    border-radius:10px;
    border:none;
}

img{
    width:100%;
    border-radius:15px;
}
</style>
</head>

<body>

<div class="container">

<h1 style="color:#00ffcc;">NEXO Studio</h1>

<div id="loginDiv">
<h2>Entrar</h2>
<input type="email" id="email" placeholder="Seu e-mail">
<input type="password" id="senha" placeholder="Sua senha">
<br>
<button onclick="login()">Entrar</button>
</div>

<div id="torneioDiv" style="display:none;">
<div class="card">
<img src="https://supercell.com/en/games/brawlstars/">

<h2>Brawl Stars Cup NS</h2>

<p><b>Entrada:</b> R$ 0,50</p>
<p><b>1º:</b> R$ 10</p>
<p><b>2º:</b> R$ 3</p>
<p><b>3º:</b> R$ 1</p>

<p id="vagas"></p>

<button onclick="inscrever()">Inscrever-se</button>
</div>
</div>

<div id="pixDiv" style="display:none;">
<div class="card">
<h2>Pagamento via Pix</h2>
<p>Chave Pix:</p>
<p style="color:#00ffcc;">bernardemachado14@gmail.com</p>

<img src="https://drive.google.com/file/d/13Rx8r9RYnCtdava5PhQUYti1MAjyI">

<p>Após pagar, espere aprovação.</p>
</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, addDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDj5-aBr2n_wg80HswcaIOjetm7DtxILSI",
  authDomain: "nexostudios-site-e9458.firebaseapp.com",
  projectId: "nexostudios-site-e9458",
  storageBucket: "nexostudios-site-e9458.firebasestorage.app",
  messagingSenderId: "247851109985",
  appId: "1:247851109985:web:1b8903891240c55a376420"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = function(){
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;

    signInWithEmailAndPassword(auth,email,senha)
    .then(()=>{
        alert("Login realizado!");
    })
    .catch(()=>{
        alert("Erro no login.");
    });
}

onAuthStateChanged(auth, async (user)=>{
    if(user){
        document.getElementById("loginDiv").style.display="none";
        document.getElementById("torneioDiv").style.display="block";

        const torneioRef = doc(db,"torneios","torneio1");
        const torneioSnap = await getDoc(torneioRef);

        if(torneioSnap.exists()){
            const data = torneioSnap.data();

            const inscritosRef = collection(db,"torneios","torneio1","inscritos");
            const inscritosSnap = await getDocs(inscritosRef);

            document.getElementById("vagas").innerText =
            "Vagas: "+ inscritosSnap.size + " / " + data.limite;
        }
    }
});

window.inscrever = async function(){
    const user = auth.currentUser;

    if(!user){
        alert("Faça login primeiro!");
        return;
    }

    const inscritosRef = collection(db,"torneios","torneio1","inscritos");

    await addDoc(inscritosRef,{
        nome:user.email,
        email:user.email,
        status:"aguardando",
        pixPago:false
    });

    document.getElementById("pixDiv").style.display="block";
    alert("Inscrição registrada! Faça o Pix.");
}

</script>

</body>
</html>
