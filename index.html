<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexo Studios - Torneios</title>
<style>
  body { background: #0a0a1f; color: #00ffcc; font-family: Arial, sans-serif; }
  .torneio { border: 2px solid #00ffcc; padding: 15px; margin: 10px; border-radius: 10px; }
  button { background: #00ffcc; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; color: #000; font-weight: bold; }
  button:active { transform: scale(0.95); }
  img { max-width: 100%; border-radius: 10px; }
</style>
</head>
<body>

<h1>Nexo Studios - Torneios</h1>
<div id="torneiosContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Config Firebase que você me mandou
const firebaseConfig = {
  apiKey: "AIzaSyDj5-aBr2n_wg80HswcaIOjetm7DtxILSI",
  authDomain: "nexostudios-site-e9458.firebaseapp.com",
  databaseURL: "https://nexostudios-site-e9458-default-rtdb.firebaseio.com",
  projectId: "nexostudios-site-e9458",
  storageBucket: "nexostudios-site-e9458.firebasestorage.app",
  messagingSenderId: "247851109985",
  appId: "1:247851109985:web:1b8903891240c55a376420"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let usuarioLogado = null;

// Detecta login
onAuthStateChanged(auth, (user) => {
  if(user){
    usuarioLogado = user;
    carregarTorneios();
  } else {
    document.getElementById('torneiosContainer').innerHTML = "<p>Faça login para ver os torneios.</p>";
  }
});

// Função para carregar torneios
async function carregarTorneios(){
  const container = document.getElementById('torneiosContainer');
  container.innerHTML = "";
  const torneiosSnapshot = await getDocs(collection(db, "torneios"));
  torneiosSnapshot.forEach((docT, index) => {
    const torneio = docT.data();
    container.innerHTML += `
      <div class="torneio">
        <h2>${torneio.nome}</h2>
        <img src="${torneio.imagem}" alt="${torneio.nome}">
        <p>Data: ${torneio.data}</p>
        <p>Taxa de inscrição: R$ ${torneio.taxa}</p>
        <p>Prêmios: 1º: R$ ${torneio.primeiro}, 2º: R$ ${torneio.segundo}, 3º: R$ ${torneio.terceiro}</p>
        <p>Vagas disponíveis: ${torneio.limite - (torneio.inscritos ? torneio.inscritos.length : 0)}</p>
        <input type="text" id="telefone${index}" placeholder="Digite seu número" />
        <br>
        <button onclick="window.inscrever(${index}, '${docT.id}')">Inscrever-se via Pix</button>
        <button onclick="window.inscreverPresencial(${index}, '${docT.id}')">Pago pessoalmente</button>
      </div>
    `;
  });
}

// Função de inscrição via Pix
window.inscrever = async function(index, torneioId){
  if(!usuarioLogado){
    alert("Faça login primeiro!");
    return;
  }
  const telefone = document.getElementById(`telefone${index}`).value;
  if(!telefone){
    alert("Digite seu número para contato!");
    return;
  }

  const torneioRef = doc(db, "torneios", torneioId);
  const torneioSnap = await getDocs(torneioRef);
  // Adiciona usuário aos inscritos
  await updateDoc(torneioRef, {
    inscritos: [...(torneioSnap.data().inscritos || []), {
      nome: usuarioLogado.displayName || "Nome não definido",
      email: usuarioLogado.email,
      username: usuarioLogado.displayName || "Username",
      telefone,
      aprovado: false,
      metodo: "Pix"
    }]
  });
  alert("Inscrição via Pix enviada! Aguarde confirmação.");
}

// Função de inscrição presencial
window.inscreverPresencial = async function(index, torneioId){
  if(!usuarioLogado){
    alert("Faça login primeiro!");
    return;
  }
  const telefone = document.getElementById(`telefone${index}`).value;
  if(!telefone){
    alert("Digite seu número para contato!");
    return;
  }

  const torneioRef = doc(db, "torneios", torneioId);
  const torneioSnap = await getDocs(torneioRef);
  await updateDoc(torneioRef, {
    inscritos: [...(torneioSnap.data().inscritos || []), {
      nome: usuarioLogado.displayName || "Nome não definido",
      email: usuarioLogado.email,
      username: usuarioLogado.displayName || "Username",
      telefone,
      aprovado: false,
      metodo: "Presencial"
    }]
  });
  alert("Inscrição presencial enviada! Aguarde confirmação.");
}

</script>

</body>
</html>
