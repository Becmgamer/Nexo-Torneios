<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXO Studio - Torneios</title>
<script type="module">
  // Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // Sua configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDj5-aBr2n_wg80HswcaIOjetm7DtxILSI",
    authDomain: "nexostudios-site-e9458.firebaseapp.com",
    databaseURL: "https://nexostudios-site-e9458-default-rtdb.firebaseio.com",
    projectId: "nexostudios-site-e9458",
    storageBucket: "nexostudios-site-e9458.firebasestorage.app",
    messagingSenderId: "247851109985",
    appId: "1:247851109985:web:1b8903891240c55a376420"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Variáveis globais
  let usuarioLogado = null;

  // Função criar usuário
  window.criarUsuario = async () => {
    const nome = document.getElementById("nome").value;
    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    const repetirSenha = document.getElementById("repetirSenha").value;
    const telefone = document.getElementById("telefone").value;

    if (!nome || !username || !email || !senha || !repetirSenha || !telefone) {
      alert("Preencha todos os campos!");
      return;
    }
    if (senha !== repetirSenha) {
      alert("Senhas não conferem!");
      return;
    }

    try {
      const docRef = await addDoc(collection(db, "usuarios"), {
        nome,
        username,
        email,
        senha,
        telefone,
        cashback: 0,
        contato: false,
        aprovado: false
      });
      alert("Conta criada com sucesso!");
      document.getElementById("formRegistro").reset();
    } catch (e) {
      alert("Erro ao criar conta: " + e);
    }
  };

  // Função login
  window.loginUsuario = async () => {
    const email = document.getElementById("loginEmail").value;
    const senha = document.getElementById("loginSenha").value;

    const querySnapshot = await getDocs(collection(db, "usuarios"));
    let usuarioEncontrado = null;
    querySnapshot.forEach((docu) => {
      const data = docu.data();
      if (data.email === email && data.senha === senha) {
        usuarioEncontrado = { id: docu.id, ...data };
      }
    });

    if (!usuarioEncontrado) {
      alert("Email ou senha incorretos!");
      return;
    }

    usuarioLogado = usuarioEncontrado;
    document.getElementById("loginContainer").style.display = "none";
    document.getElementById("torneiosContainer").style.display = "block";
    carregarTorneios();
  };

  // Função carregar torneios
  async function carregarTorneios() {
    const torneiosRef = collection(db, "torneios");
    const snapshot = await getDocs(torneiosRef);
    const container = document.getElementById("listaTorneios");
    container.innerHTML = "";

    snapshot.forEach((torneio) => {
      const data = torneio.data();
      const card = document.createElement("div");
      card.className = "torneioCard";

      card.innerHTML = `
        <img src="${data.imagem}" alt="${data.nome}" class="torneioImagem">
        <h2>${data.nome}</h2>
        <p>Data de inscrição: ${data.dataInscricao}</p>
        <p>Data de início: ${data.dataInicio}</p>
        <p>Taxa: R$ ${data.taxa.toFixed(2)}</p>
        <p>Prêmios: 1º R$ ${data.premio1}, 2º R$ ${data.premio2}, 3º R$ ${data.premio3}</p>
        <p>Vagas disponíveis: ${data.vagasDisponiveis}</p>
        <button onclick="inscreverTorneio('${torneio.id}', 'pix')">Pagar via Pix</button>
        <button onclick="inscreverTorneio('${torneio.id}', 'presencial')">Pago pessoalmente</button>
      `;
      container.appendChild(card);
    });
  }

  // Função inscrição
  window.inscreverTorneio = async (torneioId, metodoPagamento) => {
    if (!usuarioLogado) {
      alert("Você precisa estar logado!");
      return;
    }

    const torneioDoc = doc(db, "torneios", torneioId);
    const inscritosRef = collection(torneioDoc, "inscritos");

    try {
      await addDoc(inscritosRef, {
        usuarioId: usuarioLogado.id,
        nome: usuarioLogado.nome,
        username: usuarioLogado.username,
        email: usuarioLogado.email,
        telefone: usuarioLogado.telefone,
        metodoPagamento,
        aprovado: false
      });

      alert(`Inscrição feita com sucesso! Aguarde aprovação.`);
    } catch (e) {
      alert("Erro na inscrição: " + e);
    }
  };
</script>

<style>
  body { font-family: Arial, sans-serif; background: #0a0f20; color: #fff; margin:0; padding:0;}
  h1, h2 { color: #00f0ff; }
  input, button { padding: 10px; margin: 5px 0; width: 100%; }
  button { cursor: pointer; background: #0ff; color: #000; border:none; font-weight: bold; }
  .torneioCard { background: #001122; margin:10px; padding:10px; border: 2px solid #0ff; border-radius:10px; }
  .torneioImagem { width:100%; max-height:150px; object-fit:cover; border-radius:5px; }
</style>
</head>
<body>

<div id="loginContainer">
  <h1>Login</h1>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginSenha" placeholder="Senha">
  <button onclick="loginUsuario()">Entrar</button>

  <h2>Ou criar nova conta</h2>
  <form id="formRegistro" onsubmit="event.preventDefault(); criarUsuario();">
    <input type="text" id="nome" placeholder="Nome completo">
    <input type="text" id="username" placeholder="Username">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="senha" placeholder="Senha">
    <input type="password" id="repetirSenha" placeholder="Repetir senha">
    <input type="text" id="telefone" placeholder="Telefone">
    <button type="submit">Criar conta</button>
  </form>
</div>

<div id="torneiosContainer" style="display:none;">
  <h1>Torneios Disponíveis</h1>
  <div id="listaTorneios"></div>
</div>

</body>
</html>
